import{a as k}from"./chunk-4BQZLGFG.js";import{V as s,Y as m,_ as l,c as h,g as c,ja as p,wa as f}from"./chunk-KXY2N67X.js";var w=new m("JWT_OPTIONS"),S=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,n,a,I=0;a=e.charAt(I++);~a&&(n=i%4?n*64+a:a,i++%4)?r+=String.fromCharCode(255&n>>(-2*i&6)):0)a=t.indexOf(a);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let r=this.getTokenExpirationDate(e);return t=t||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(l(w))},o.\u0275prov=s({token:o,factory:o.\u0275fac}),o})();var E=(()=>{class o{constructor(){}setLocalItem(e,t){localStorage.setItem(e,t)}getLocalItem(e){return localStorage.getItem(e)}removeLocalItem(e){localStorage.removeItem(e)}clearLocal(){localStorage.clear()}setSessionItem(e,t){sessionStorage.setItem(e,t)}getSessionItem(e){return sessionStorage.getItem(e)}removeSessionItem(e){sessionStorage.removeItem(e)}clearSession(){sessionStorage.clear()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var U=(()=>{class o{constructor(e){this.storageService=e,this.TOKEN_KEY="accessToken",this.REFRESH_TOKEN_KEY="refreshToken",this.EXPIRES_IN_KEY="expiresIn",this.tokenSubject=new c(this.loadToken()),this.token$=this.tokenSubject.asObservable(),this.jwtHelper=new S}loadToken(){return sessionStorage.getItem(this.TOKEN_KEY)}setToken(e,t,r){this.tokenSubject.next(e),this.storageService.setSessionItem(this.TOKEN_KEY,e),this.storageService.setSessionItem(this.REFRESH_TOKEN_KEY,t),this.storageService.setSessionItem(this.EXPIRES_IN_KEY,r.toString())}getToken(){return this.tokenSubject.value}getRefreshToken(){return sessionStorage.getItem(this.REFRESH_TOKEN_KEY)}getExpiresIn(){let e=sessionStorage.getItem(this.EXPIRES_IN_KEY);return e?parseInt(e,10):0}removeToken(){this.tokenSubject.next(null),this.removeRefreshToken(),this.removeExpiresIn()}removeRefreshToken(){this.storageService.removeSessionItem(this.REFRESH_TOKEN_KEY)}removeExpiresIn(){this.storageService.removeSessionItem(this.EXPIRES_IN_KEY)}getUserInfo(){let e=this.getToken();return e?this.decodeToken(e):null}isAuthenticated(){let e=this.getUserInfo();return!!e&&this.isTokenValid(e)}decodeToken(e){try{let t=e.split(".")[1];return JSON.parse(atob(t))}catch(t){return console.error("Erro ao decodificar token:",t),null}}isTokenValid(e){return!e||!e.exp?!1:e.exp*1e3>Date.now()}isTokenExpired(){let e=this.getToken();return e?this.jwtHelper.isTokenExpired(e):!0}isTokenExpiringSoon(){let e=this.getToken();if(!e)return!1;let t=this.jwtHelper.decodeToken(e);if(!t||!t.exp)return!1;let r=t.exp*1e3,i=Date.now(),n=r-i;return console.log(`Tempo restante do token: ${Math.round(n/1e3)} segundos`),n<5*60*1e3}static{this.\u0275fac=function(t){return new(t||o)(l(E))}}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var d={ENABLE_MOCK_MODE:!0,DEFAULT_MOCK_USER:{id:"stonkz-user-001",email:"appstonkz@gmail.com",name:"App Stonkz",role:"premium_user",subscription:{plan:"premium",status:"active",expiresAt:new Date(Date.now()+31536e6).toISOString()}},NETWORK_DELAY:{login:1e3,logout:500,dataLoad:800},MESSAGES:{mockModeEnabled:"Modo de desenvolvimento ativado - Dados simulados",mockModeDisabled:"Modo de desenvolvimento desativado",usingMockData:"Usando dados simulados (modo desenvolvimento)",loginInstructions:"Use: appstonkz@gmail.com / Stonkz@1"},MOCK_SPECIFIC:{allowedCredentials:{email:"appstonkz@gmail.com",password:"Stonkz@1"},mockedApis:["auth/login","auth/logout","user/profile","user/wallet","user/statistics","user/connections"],availableData:["Perfil completo do usu\xE1rio","Carteira com transa\xE7\xF5es","Estat\xEDsticas de investimentos","Conex\xF5es e relacionamentos","Prefer\xEAncias e configura\xE7\xF5es"]}};var P=(()=>{class o{constructor(){this.isMockMode=d.ENABLE_MOCK_MODE,this.mockUserSubject=new c(this.loadMockUser()),this.mockUser$=this.mockUserSubject.asObservable(),this.MOCK_CREDENTIALS={email:"appstonkz@gmail.com",password:"Stonkz@1",name:"App Stonkz",role:"premium_user"},this.mockUserSubject.value||this.createDefaultMockUser()}loadMockUser(){let e=localStorage.getItem("mockUser");return e?JSON.parse(e):null}saveMockUser(e){localStorage.setItem("mockUser",JSON.stringify(e))}createDefaultMockUser(){let e={id:"stonkz-user-001",email:this.MOCK_CREDENTIALS.email,name:this.MOCK_CREDENTIALS.name,role:this.MOCK_CREDENTIALS.role,subscription:{plan:"premium",status:"active",expiresAt:new Date(Date.now()+31536e6).toISOString()}};this.mockUserSubject.next(e),this.saveMockUser(e)}login(e,t){return new h(r=>{setTimeout(()=>{if(e===this.MOCK_CREDENTIALS.email&&t===this.MOCK_CREDENTIALS.password){let i={id:"stonkz-user-"+Date.now(),email:this.MOCK_CREDENTIALS.email,name:this.MOCK_CREDENTIALS.name,role:this.MOCK_CREDENTIALS.role,subscription:{plan:"premium",status:"active",expiresAt:new Date(Date.now()+31536e6).toISOString()}};this.mockUserSubject.next(i),this.saveMockUser(i),r.next({success:!0,message:"Login realizado com sucesso! (Modo Mock)"})}else r.next({success:!1,message:"Credenciais inv\xE1lidas. Use: appstonkz@gmail.com / Stonkz@1"});r.complete()},d.NETWORK_DELAY.login)})}logout(){this.mockUserSubject.next(null),localStorage.removeItem("mockUser")}isAuthenticated(){return!!this.mockUserSubject.value}getCurrentUser(){return this.mockUserSubject.value}isInMockMode(){return this.isMockMode}setMockMode(e){this.isMockMode=e}getUserSubscription(){return this.mockUserSubject.value?.subscription||null}hasActiveSubscription(){let e=this.getUserSubscription();return e?new Date(e.expiresAt)>new Date&&e.status==="active":!1}getMockCredentials(){return{email:this.MOCK_CREDENTIALS.email,password:this.MOCK_CREDENTIALS.password}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Y=(()=>{class o extends k{constructor(){super(...arguments),this.tokenSignal=f(null),this.isAuthenticated=()=>!!this.tokenSignal()}login(e){return this.http.post(`${this.baseUrl}/login`,e)}refreshToken(e){return this.http.post(`${this.baseUrl}/refresh-token`,e)}logout(e){return this.http.post(`${this.baseUrl}/logout`,e)}static{this.\u0275fac=(()=>{let e;return function(r){return(e||(e=p(o)))(r||o)}})()}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{E as a,U as b,P as c,Y as d};
