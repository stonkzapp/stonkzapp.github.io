import{a as w}from"./chunk-4BQZLGFG.js";import{a as b}from"./chunk-MHD2J2H6.js";import{D as o,P as f,S as P,V as p,_ as S,c as A,g as m,j as r,n as d}from"./chunk-KXY2N67X.js";import{a as s,b as l}from"./chunk-4CLCTAJ7.js";var y=(()=>{class i{constructor(){this.plansSubject=new m([]),this.skusSubject=new m([]),this.mockPlans=[{id:"free",name:"Gratuito",type:"free",basePrice:0,currency:"BRL",description:"Plano b\xE1sico com funcionalidades limitadas",features:["Dashboard b\xE1sico","Carteira com at\xE9 10 ativos","Relat\xF3rios mensais","Suporte por email"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro",name:"PRO",type:"pro",basePrice:29.9,currency:"BRL",description:"Plano avan\xE7ado com todas as funcionalidades",features:["Dashboard completo","Carteira ilimitada","Relat\xF3rios avan\xE7ados","An\xE1lises avan\xE7adas","Otimiza\xE7\xE3o de portf\xF3lio","Relat\xF3rios fiscais","Alertas personalizados","Suporte priorit\xE1rio","App mobile nativo","Integra\xE7\xE3o com corretoras"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.mockSKUs=[{id:"free-monthly",planId:"free",name:"Gratuito Mensal",period:"monthly",price:0,originalPrice:0,currency:"BRL",discountPercentage:0,isPopular:!1,features:["Funcionalidades b\xE1sicas"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro-monthly",planId:"pro",name:"PRO Mensal",period:"monthly",price:29.9,originalPrice:29.9,currency:"BRL",discountPercentage:0,isPopular:!1,features:["Todas as funcionalidades PRO","Cobran\xE7a mensal","Cancelamento a qualquer momento"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro-semiannual",planId:"pro",name:"PRO Semestral",period:"semiannual",price:119.6,originalPrice:179.4,currency:"BRL",discountPercentage:33,isPopular:!0,features:["Todas as funcionalidades PRO","Cobran\xE7a semestral","2 meses gr\xE1tis","Economia de R$ 59,80"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro-annual",planId:"pro",name:"PRO Anual",period:"annual",price:239.2,originalPrice:358.8,currency:"BRL",discountPercentage:33,isPopular:!1,features:["Todas as funcionalidades PRO","Cobran\xE7a anual","4 meses gr\xE1tis","Economia de R$ 119,60","Melhor custo-benef\xEDcio"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.plansSubject.next([...this.mockPlans]),this.skusSubject.next([...this.mockSKUs])}getPlans(){return r(this.mockPlans).pipe(o(500))}getSKUs(){return r(this.mockSKUs).pipe(o(500))}getPlanById(e){let t=this.mockPlans.find(a=>a.id===e);return r(t||null).pipe(o(300))}getSKUById(e){let t=this.mockSKUs.find(a=>a.id===e);return r(t||null).pipe(o(300))}getSKUsByPlan(e){let t=this.mockSKUs.filter(a=>a.planId===e);return r(t).pipe(o(300))}createPlan(e){let t=l(s({},e),{id:`plan_${Date.now()}`,createdAt:new Date,updatedAt:new Date});return this.mockPlans.push(t),this.plansSubject.next([...this.mockPlans]),r(t).pipe(o(500))}updatePlan(e,t){let a=this.mockPlans.findIndex(n=>n.id===e);return a===-1?r(null):(this.mockPlans[a]=l(s(s({},this.mockPlans[a]),t),{updatedAt:new Date}),this.plansSubject.next([...this.mockPlans]),r(this.mockPlans[a]).pipe(o(500)))}deletePlan(e){let t=this.mockPlans.findIndex(a=>a.id===e);return t===-1?r(!1):(this.mockPlans.splice(t,1),this.plansSubject.next([...this.mockPlans]),r(!0).pipe(o(500)))}createSKU(e){let t=l(s({},e),{id:`sku_${Date.now()}`,createdAt:new Date,updatedAt:new Date});return this.mockSKUs.push(t),this.skusSubject.next([...this.mockSKUs]),r(t).pipe(o(500))}updateSKU(e,t){let a=this.mockSKUs.findIndex(n=>n.id===e);return a===-1?r(null):(this.mockSKUs[a]=l(s(s({},this.mockSKUs[a]),t),{updatedAt:new Date}),this.skusSubject.next([...this.mockSKUs]),r(this.mockSKUs[a]).pipe(o(500)))}deleteSKU(e){let t=this.mockSKUs.findIndex(a=>a.id===e);return t===-1?r(!1):(this.mockSKUs.splice(t,1),this.skusSubject.next([...this.mockSKUs]),r(!0).pipe(o(500)))}updatePlanPricing(e,t){return this.updatePlan(e,t)}updateSKUPricing(e,t){return this.updateSKU(e,t)}recalculatePlanPricing(e){let t=this.mockPlans.find(a=>a.id===e);return!t||t.type==="free"?r(!1):(this.recalculateSKUPrices(e,t.basePrice),r(!0).pipe(o(300)))}recalculateSKUPrices(e,t){let a={monthly:{discount:0,multiplier:1},semiannual:{discount:16,multiplier:6},annual:{discount:25,multiplier:12}};this.mockSKUs.forEach(n=>{if(n.planId===e){let u=a[n.period],c=t*u.multiplier,h=c*(1-u.discount/100);n.price=Math.round(h*100)/100,n.originalPrice=c,n.discountPercentage=u.discount,n.updatedAt=new Date}}),this.skusSubject.next([...this.mockSKUs])}getAvailableFeatures(){return r([{id:"dashboard-basic",name:"Dashboard B\xE1sico",description:"Vis\xE3o geral da sua carteira de investimentos",icon:"dashboard",isAvailable:!0,planType:"free"},{id:"dashboard-advanced",name:"Dashboard Avan\xE7ado",description:"An\xE1lises detalhadas e m\xE9tricas avan\xE7adas",icon:"analytics",isAvailable:!0,planType:"pro"},{id:"wallet-view",name:"Visualiza\xE7\xE3o de Carteira",description:"Acompanhe seus investimentos",icon:"account_balance_wallet",isAvailable:!0,planType:"free"},{id:"market-data-limited",name:"Dados de Mercado (Limitado)",description:"Informa\xE7\xF5es b\xE1sicas de mercado com delay",icon:"trending_up",isAvailable:!0,planType:"free"},{id:"market-data-real-time",name:"Dados Atualizados Diariamente",description:"Informa\xE7\xF5es de mercado atualizadas no fim do dia",icon:"schedule",isAvailable:!0,planType:"pro"},{id:"alerts",name:"Alertas Personalizados",description:"Configure alertas para seus investimentos",icon:"notifications",isAvailable:!0,planType:"pro"},{id:"reports",name:"Relat\xF3rios Detalhados",description:"Relat\xF3rios completos de performance",icon:"assessment",isAvailable:!0,planType:"pro"},{id:"api-access",name:"API de Dados",description:"Acesso program\xE1tico aos dados da plataforma",icon:"code",isAvailable:!0,planType:"pro"},{id:"backtesting",name:"Backtesting de Estrat\xE9gias",description:"Teste suas estrat\xE9gias com dados hist\xF3ricos",icon:"science",isAvailable:!0,planType:"pro"},{id:"support-email",name:"Suporte por Email",description:"Suporte b\xE1sico por email",icon:"email",isAvailable:!0,planType:"free"},{id:"support-priority",name:"Suporte Priorit\xE1rio",description:"Suporte priorit\xE1rio com resposta em at\xE9 2h",icon:"support_agent",isAvailable:!0,planType:"pro"}]).pipe(o(200))}get plans$(){return this.plansSubject.asObservable()}get skus$(){return this.skusSubject.asObservable()}resetMockData(){this.mockPlans=[{id:"free",name:"Gratuito",type:"free",basePrice:0,currency:"BRL",description:"Acesso b\xE1sico \xE0s funcionalidades da plataforma",features:["Dashboard b\xE1sico","Visualiza\xE7\xE3o de carteira","Dados de mercado limitados","Suporte por email"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro",name:"PRO",type:"pro",basePrice:29.9,currency:"BRL",description:"Acesso completo com funcionalidades avan\xE7adas",features:["Dashboard completo","An\xE1lises avan\xE7adas","Dados atualizados diariamente","Alertas personalizados","Relat\xF3rios detalhados","Suporte priorit\xE1rio","API de dados","Backtesting de estrat\xE9gias"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.mockSKUs=[{id:"pro-monthly",planId:"pro",name:"PRO Mensal",period:"monthly",price:29.9,currency:"BRL",isPopular:!1,features:["Acesso completo por 1 m\xEAs","Cancelamento a qualquer momento"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro-semiannual",planId:"pro",name:"PRO Semestral",period:"semiannual",price:149.9,originalPrice:179.4,discountPercentage:16,currency:"BRL",isPopular:!0,features:["Acesso completo por 6 meses","Economia de R$ 29,50","Cancelamento a qualquer momento"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pro-annual",planId:"pro",name:"PRO Anual",period:"annual",price:269.9,originalPrice:358.8,discountPercentage:25,currency:"BRL",isPopular:!1,features:["Acesso completo por 12 meses","Economia de R$ 88,90","Cancelamento a qualquer momento","2 meses gr\xE1tis"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.plansSubject.next([...this.mockPlans]),this.skusSubject.next([...this.mockSKUs])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var v=(()=>{class i{constructor(){this.API_BASE_URL="https://api.mercadopago.com",this.ACCESS_TOKEN=b.mercadopago?.accessToken||""}createPreference(e){let t={items:[{id:e.skuId,title:`Plano ${e.planName} - ${e.period}`,description:`Assinatura do plano ${e.planName} por ${e.period}`,quantity:1,unit_price:e.price,currency_id:e.currency,category_id:"subscription"}],back_urls:{success:`${window.location.origin}/dashboard/profile/subscription/success`,failure:`${window.location.origin}/dashboard/profile/subscription/failure`,pending:`${window.location.origin}/dashboard/profile/subscription/pending`},auto_return:"approved",external_reference:`${e.userId}_${e.skuId}_${Date.now()}`,expires:!0,expiration_date_to:new Date(Date.now()+18e5).toISOString(),notification_url:`${b.apiUrl}/webhooks/mercadopago`};return r({id:`pref_${Date.now()}`,init_point:`https://www.mercadopago.com.br/checkout/v1/redirect?pref_id=pref_${Date.now()}`,sandbox_init_point:`https://sandbox.mercadopago.com.br/checkout/v1/redirect?pref_id=pref_${Date.now()}`,external_reference:t.external_reference,items:t.items,back_urls:t.back_urls,auto_return:t.auto_return,expires:t.expires,expiration_date_to:t.expiration_date_to})}processPayment(e){let t={id:e,preferenceId:`pref_${Date.now()}`,status:"approved",amount:29.9,currency:"BRL",paymentMethod:"credit_card",createdAt:new Date,updatedAt:new Date};return r(t)}getPaymentStatus(e){let t={id:parseInt(e),status:"approved",status_detail:"accredited",external_reference:`user_123_pro_monthly_${Date.now()}`,transaction_amount:29.9,payment_method_id:"credit_card",payment_type_id:"credit_card",date_created:new Date().toISOString(),date_approved:new Date().toISOString(),date_last_modified:new Date().toISOString(),payer:{id:123456,email:"user@example.com",identification:{type:"CPF",number:"12345678901"}}};return r(t)}cancelSubscription(e){return r(!0)}renewSubscription(e){return r(!0)}getPaymentHistory(e){return r([{id:"pay_001",preferenceId:"pref_001",status:"approved",amount:29.9,currency:"BRL",paymentMethod:"credit_card",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"pay_002",preferenceId:"pref_002",status:"approved",amount:29.9,currency:"BRL",paymentMethod:"credit_card",createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-01")}])}redirectToCheckout(e,t=!1){let a=t?`https://sandbox.mercadopago.com.br/checkout/v1/redirect?pref_id=${e}`:`https://www.mercadopago.com.br/checkout/v1/redirect?pref_id=${e}`;window.location.href=a}openCheckoutModal(e){console.log("Abrindo checkout modal para prefer\xEAncia:",e)}validateWebhook(e,t){return!0}processWebhook(e){return console.log("Processando webhook:",e),r(!0)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var B=(()=>{class i extends w{constructor(e,t){super(),this.mercadoPagoService=e,this.planPricingService=t,this.currentSubscriptionSubject=new m(null),this.currentSubscription$=this.currentSubscriptionSubject.asObservable()}getAvailablePlans(){return this.planPricingService.getPlans().pipe(d(e=>e.map(t=>({id:t.id,name:t.name,type:t.type,description:t.description,features:t.features,isActive:t.isActive,createdAt:t.createdAt,updatedAt:t.updatedAt}))))}getAvailableSKUs(e){return e==="free"?r([]):this.planPricingService.getSKUsByPlan(e).pipe(d(t=>t.map(a=>({id:a.id,planId:a.planId,name:a.name,period:a.period,price:a.price,originalPrice:a.originalPrice,currency:a.currency,isPopular:a.isPopular,discountPercentage:a.discountPercentage,features:a.features,isActive:a.isActive,createdAt:a.createdAt,updatedAt:a.updatedAt}))))}getAvailableFeatures(){return this.planPricingService.getAvailableFeatures().pipe(d(e=>e.map(t=>({id:t.id,name:t.name,description:t.description,icon:t.icon,isAvailable:t.isAvailable,planType:t.planType}))))}getCurrentSubscription(e){let t={id:"sub_123",userId:e,planId:"pro",skuId:"pro-semiannual",status:"active",startDate:new Date("2024-01-01"),endDate:new Date("2024-07-01"),nextPaymentDate:new Date("2024-07-01"),autoRenew:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")};return this.currentSubscriptionSubject.next(t),r(t)}createSubscription(e){if(!e.userId||!e.skuId||!e.planId)throw new Error("Dados de assinatura incompletos");return this.getAvailableSKUs(e.planId).pipe(f(t=>{let a=t.find(n=>n.id===e.skuId);if(!a)throw new Error("SKU n\xE3o encontrado");return this.mercadoPagoService.createPreference({planId:e.planId,skuId:e.skuId,userId:e.userId,planName:"PRO",period:this.getPeriodInPortuguese(a.period),price:a.price,currency:a.currency})}))}processApprovedPayment(e){return this.mercadoPagoService.processPayment(e).pipe(f(t=>{let a={id:`sub_${Date.now()}`,userId:"user-123",planId:"pro",skuId:"pro-monthly",status:"active",startDate:new Date,endDate:new Date(Date.now()+2592e6),nextPaymentDate:new Date(Date.now()+2592e6),autoRenew:!0,createdAt:new Date,updatedAt:new Date};return this.currentSubscriptionSubject.next(a),r(a)}))}cancelSubscription(e){return this.mercadoPagoService.cancelSubscription(e).pipe(P(t=>{if(t){let a=this.currentSubscriptionSubject.value;a&&a.id===e&&(a.status="cancelled",this.currentSubscriptionSubject.next(a))}}))}renewSubscription(e){return this.mercadoPagoService.renewSubscription(e).pipe(P(t=>{if(t){let a=this.currentSubscriptionSubject.value;a&&a.id===e&&(a.endDate=new Date(Date.now()+30*24*60*60*1e3),a.nextPaymentDate=new Date(Date.now()+30*24*60*60*1e3),a.updatedAt=new Date,this.currentSubscriptionSubject.next(a))}}))}hasFeatureAccess(e,t){return new A(a=>{this.getCurrentSubscription(e).subscribe(n=>{if(!n||n.status!=="active"){a.next(!1),a.complete();return}this.getAvailableFeatures().subscribe(u=>{let c=u.find(h=>h.id===t);if(!c){a.next(!1),a.complete();return}c.planType==="free"||c.planType==="pro"&&n.planId==="pro"?a.next(!0):a.next(!1),a.complete()})})})}formatPrice(e,t="BRL"){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:t}).format(e)}calculateSavings(e,t){return e-t}getPeriodInPortuguese(e){return{monthly:"Mensal",semiannual:"Semestral",annual:"Anual"}[e]||e}redirectToCheckout(e){this.mercadoPagoService.redirectToCheckout(e,!0)}updatePlanBasePrice(e,t){return this.planPricingService.updatePlanPricing(e,{basePrice:t}).pipe(d(a=>!!a))}updateSKUPrice(e,t){return this.planPricingService.updateSKUPricing(e,{price:t}).pipe(d(a=>!!a))}recalculatePlanPricing(e){return this.planPricingService.recalculatePlanPricing(e)}get plans$(){return this.planPricingService.plans$}get skus$(){return this.planPricingService.skus$}static{this.\u0275fac=function(t){return new(t||i)(S(v),S(y))}}static{this.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{y as a,B as b};
