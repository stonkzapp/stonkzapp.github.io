<div class="subscription-container">
  <!-- Assinatura Atual -->
  <div class="current-subscription" *ngIf="currentSubscription">
    <mat-card class="current-subscription-card">
      <mat-card-header>
        <mat-card-title>
          <!-- <mat-icon>rocket_launch</mat-icon> -->
          Sua Assinatura Atual
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="subscription-info">
          <div class="subscription-details">
            <h3>Plano PRO Semestral</h3>
            <p>Status: <span class="status-active">Ativo</span></p>
            <p>
              Próximo pagamento:
              {{ currentSubscription.nextPaymentDate | date : 'dd/MM/yyyy' }}
            </p>
            <p>
              Renovação automática:
              {{ currentSubscription.autoRenew ? 'Sim' : 'Não' }}
            </p>
          </div>
          <div class="subscription-actions">
            <app-button
              label="Renovar"
              iconLeft="refresh"
              color="primary"
              [width]="'120px'"
              [height]="'40px'"
              (click)="onRenewSubscription()">
            </app-button>
            <app-button
              label="Cancelar"
              iconLeft="cancel"
              color="danger"
              [width]="'120px'"
              [height]="'40px'"
              (click)="onCancelSubscription()">
            </app-button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Planos Disponíveis -->
  <div class="plans-section" *ngIf="plans.length > 0">
    <div class="section-header">
      <h2 class="section-title">Escolha seu plano</h2>
      <p class="section-description">
        Comece grátis e evolua conforme suas necessidades
      </p>
    </div>

    <div class="plans-grid">
      <!-- Plano Gratuito -->
      <mat-card
        class="plan-card free-plan"
        [class.selected]="selectedPlan?.id === 'free'"
        (click)="selectPlan(plans[0])">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>free_breakfast</mat-icon>
            {{ plans[0].name }}
          </mat-card-title>
          <mat-card-subtitle>{{ plans[0].description }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="plan-price">
            <span class="price-amount">Grátis</span>
            <span class="price-period">Para sempre</span>
          </div>

          <div class="plan-features">
            <h4>Funcionalidades Incluídas:</h4>
            <ul>
              <li *ngFor="let feature of getPlanFeatures('free')">
                <mat-icon class="check-icon">check_circle</mat-icon>
                {{ feature.name }}
              </li>
            </ul>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <app-button
            label="Usar Gratuitamente"
            iconLeft="check"
            color="secondary"
            [width]="'100%'"
            [height]="'44px'"
            (click)="onSubscribe(plans[0])">
          </app-button>
        </mat-card-actions>

        <div class="plan-status">
          <mat-chip [color]="getPlanStatusColor(plans[0].id)" selected>
            {{ getPlanStatus(plans[0].id) }}
          </mat-chip>
        </div>
      </mat-card>

      <!-- Plano PRO -->
      <mat-card
        class="plan-card premium-plan"
        [class.selected]="selectedPlan?.id === 'pro'"
        (click)="selectPlan(plans[1])">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>rocket_launch</mat-icon>
            {{ plans[1].name }}
          </mat-card-title>
          <mat-card-subtitle>{{ plans[1].description }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="plan-price">
            <span class="price-amount">A partir de R$ 29,90</span>
            <span class="price-period">por mês</span>
          </div>

          <div class="plan-features">
            <h4>Funcionalidades Incluídas:</h4>
            <ul>
              <li *ngFor="let feature of getPlanFeatures('pro')">
                <mat-icon class="check-icon">check_circle</mat-icon>
                {{ feature.name }}
              </li>
            </ul>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <app-button
            label="Escolher PRO"
            iconLeft="arrow_forward"
            color="primary"
            [width]="'100%'"
            [height]="'44px'"
            (click)="onSubscribe(plans[1])">
          </app-button>
        </mat-card-actions>

        <div class="plan-status">
          <mat-chip [color]="getPlanStatusColor(plans[1].id)" selected>
            {{ getPlanStatus(plans[1].id) }}
          </mat-chip>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- SKUs do Plano PRO -->
  <div class="skus-section" *ngIf="selectedPlan?.type === 'pro'">
    <h2 class="section-title">Escolha a Periodicidade</h2>

    <div class="skus-grid">
      @for (sku of planSKUs; track sku.id) {
      <mat-card class="sku-card" [class.popular]="sku.isPopular">
        @if (sku.isPopular) {
        <div class="popular-badge">Mais Popular</div>
        }
        <mat-card-header>
          <mat-card-title>{{ sku.name }}</mat-card-title>
          <mat-card-subtitle>
            @if (sku.originalPrice && sku.originalPrice > sku.price) {
            <span class="original-price">{{
              formatPrice(sku.originalPrice, sku.currency)
            }}</span>
            <span class="current-price">{{
              formatPrice(sku.price, sku.currency)
            }}</span>
            <span class="discount">-{{ sku.discountPercentage }}%</span>
            } @else {
            {{ formatPrice(sku.price, sku.currency) }}
            }
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="sku-features">
            <ul>
              @for (feature of sku.features; track feature) {
              <li>{{ feature }}</li>
              }
            </ul>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <app-button
            label="Assinar {{ sku.name }}"
            iconLeft="payment"
            color="primary"
            [width]="'100%'"
            [height]="'44px'"
            [loading]="isProcessingPayment"
            [disabled]="isProcessingPayment"
            (click)="onSubscribe(selectedPlan!, sku)">
          </app-button>
        </mat-card-actions>
      </mat-card>
      }
    </div>
  </div>

  <!-- Comparação de Funcionalidades -->
  <div class="features-comparison" *ngIf="features.length > 0">
    <h2 class="section-title">Comparação de Funcionalidades</h2>

    <mat-card class="comparison-card">
      <mat-card-content>
        <div class="comparison-table">
          <div class="table-header">
            <div class="feature-name">Funcionalidade</div>
            <div class="plan-free">Gratuito</div>
            <div class="plan-premium">PRO</div>
          </div>

          <div class="table-row" *ngFor="let feature of features">
            <div class="feature-name">
              <mat-icon>{{ feature.icon }}</mat-icon>
              {{ feature.name }}
            </div>
            <div class="plan-free">
              <mat-icon
                *ngIf="feature.planType === 'free'"
                class="feature-available">
                check_circle
              </mat-icon>
              <mat-icon
                *ngIf="feature.planType === 'pro'"
                class="feature-unavailable">
                cancel
              </mat-icon>
            </div>
            <div class="plan-premium">
              <mat-icon class="feature-available">check_circle</mat-icon>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
